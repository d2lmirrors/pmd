===============================================================================

	PMD用 MusicCompiler "MC.EXE" ver.4.8	Document
						by M.Kajihara(KAJA)

===============================================================================

>MC [/Option[/Option]･･] MMLファイル名[.MML] FM音色ファイル名[.FF] 拡張子省略可

	として使用すると、エラーが無い限り、.MMLから.Mファイルが作成されます。
	エラーがあった場合は、その時点で、エラー箇所とエラーメッセージを表示
	して終了します。

	アップロードされている殆どのMMLデータは、
>MC /V/P filename[.MML]
	とすると、コンパイル＆演奏されます。

	MMLの仕様については PMDMML.MAN をご覧下さい。

(注)	PMDを常駐してからこのコンパイラを使用する場合、PMD音色データバッファの
	大きさはデフォルトの8KBを維持して下さい。(->PMDの/Vオプション)

===============================================================================
	オプションについて
-------------------------------------------------------------------------------
	環境変数 "MCOPT=" が定義されている場合は、その文字列を自動的に
	オプションとして取り込みます。

	コマンドラインで同時に使用出来ないオプションとぶつかった場合は、
	コマンドラインの方のオプションが優先されます。

	使用出来るオプションは以下の通りです。

-------------------------------------------------------------------------------
/V
-------------------------------------------------------------------------------
	コンパイル後の曲データに、その曲で使用されているＦＭ音色データを
	添付します。なお、ＦＭ音色データファイル名が、MMLファイル名の後に
	指定されていて、且つそれが存在する場合は、自動的にこのオプションが
	指定されている事になります。

-------------------------------------------------------------------------------
/VW
-------------------------------------------------------------------------------
	.MML から .FF を作成または変更したい時に使用します。

	FM音色データファイル名が指定されていた場合にのみ有効で、

1)	FM音色データファイルが存在しない場合
	　コンパイル後、FM音色データファイルを新規に作成します。
	　その際作成されるデータは、PMD内の音色データバッファに、MML内に定義
	　されているFM音色データを更新したものになります。

2)	FM音色データファイルが存在する場合
	　コンパイル後、FM音色データファイルを書き換えます。
	　書き込まれるデータは、PMD内音色データバッファに、指定された
	　音色ファイルを上書きし、さらにMML内に指定されているFM音色データを
	　更新したものになります。

-------------------------------------------------------------------------------
/N
-------------------------------------------------------------------------------
	OPN仕様(DT2無し/ABCDEF=FM,GHI=SSG)でコンパイルします。
	デフォルトなので指定する必要はありません。

-------------------------------------------------------------------------------
/L
-------------------------------------------------------------------------------
	OPL仕様(2op音色/ABCDEFGHI=FM)でコンパイルします。
	IBMPCのPMD用の曲を作成する時にのみ使用します。

-------------------------------------------------------------------------------
/M
-------------------------------------------------------------------------------
	OPM仕様(DT2有り/ABCDEFGH=FM)でコンパイルします。
	X68000のPMD用の曲を作成する時にのみ使用します。

-------------------------------------------------------------------------------
/T
-------------------------------------------------------------------------------
	TOWNS仕様(DT2無し/ABCDEF=FM,JK=PCM)でコンパイルします。
	FM-TOWNSのPMD用の曲を作成する時にのみ使用します。

-------------------------------------------------------------------------------
/P
-------------------------------------------------------------------------------
	コンパイル後にそのまま即演奏します。PMDが常駐していないと無効です。

-------------------------------------------------------------------------------
/S
-------------------------------------------------------------------------------
	コンパイル後、データを保存せずに、即演奏します。

	.Mを作らずに.MMLを演奏させたい場合や、フロッピーベースで曲を作成して
	いる場合のコンパイル時間短縮といった用途に使用します。

	これもPMDが常駐していないとデータの保存をしないで演奏も出来ないので
	指定しても意味がありません。

-------------------------------------------------------------------------------
/A
-------------------------------------------------------------------------------
	PCMデータを読み込まないようにします。
	PMDB2/PMDVA/PMD86が常駐している場合、曲演奏時にMML中に#PCMFile等で指定
	しているPCMデータを読み込みますが、このオプションはそれを抑制します。

	演奏オプション(/P,/S)が指定されていない限り無意味です。

-------------------------------------------------------------------------------
/O
-------------------------------------------------------------------------------
	Title文字列を表示しないようにします。
	演奏開始と同時に、PCMファイル名、曲のタイトル、作曲／編曲者名、メモが
	MML中に定義されていれば表示しますが、このオプションはそれを抑制します。

	演奏オプション(/P,/S)が指定されていない限り無意味です。

-------------------------------------------------------------------------------
/C
-------------------------------------------------------------------------------
	コンパイル後にパート毎の長さを表示します。( 全体 / L指定後 )
	ループする際にずれている場合のCHECKをする時に有効です。

	但し、[ ･･･ ]0 といった、局所無限ループがあった場合は、
	長さは表示されません。

-------------------------------------------------------------------------------

!注意!	.MMLデータと、MML内で指定される#includeファイルとの合計の、最大
	コンパイル可能サイズが61KB(62,464bytes)になっています。
	それ以上大きなMMLファイル、又は#includeで指定されるファイルを合計した
	サイズがそれ以上大きくなるとコンパイル出来ませんので注意してください。
	また、コンパイル後のデータの最大は63KB(64,512bytes)になっています。

===============================================================================
	FM音源の音色データ(以下"音色")の扱いについて
-------------------------------------------------------------------------------

	MC.EXEでの音色の扱いはいろいろと複雑になっています。最初のうちは、

1)	MML中に曲中で使用する総ての音色を定義する。
2)	必ず /V オプションを指定するようにする。

	の２つさえ守っていれば、それほど混乱する事はないはずです。
	慣れて来たら、以下の説明文を読んでさらに使いこなしてみて下さい。

-------------------------------------------------------------------------------

	大抵の他の音楽ドライバの場合は、音色はMML中に全て定義するものが多いの
	ですが、MC.EXEの場合、以下の種類の音色ソースが利用できます。

-------------------------------------------------------------------------------
1)	MML中に定義されている音色。
-------------------------------------------------------------------------------
	/Vオプションを指定すれば自動的に使用されます。

	普通にMML中に定義されている音色です。これだけで賄ったとしても
	何の問題もありません。

ex.
>mc /v sample1.mml
条件/	sample1.mml中にはその曲で使用する総ての音色が定義してある。
結果/	総ての音色はMML内に定義されている音色を使用し、
	音色データ付きの曲データが作成される。

-------------------------------------------------------------------------------
2)	付属の音色エディタ"VED.EXE"で作成される、拡張子 .FF のファイル。
-------------------------------------------------------------------------------
1.	コマンドラインに音色ファイル名を指定してある
2.	使用されている音色がMML中に定義されていない
	の２つの条件が重なった場合に、使用されます。

	例えば88のプリセット音だけで曲を作成したといった場合、
	付属の"PC88.FF"という音色ファイル名をコンパイル時にコマンドラインに追加
	するだけで、音色をMML中に定義する必要がなくなります。

ex.1
>mc sample2 effec
条件1/	sample2.mml中には一つも音色は定義されていない。
条件2/	effec.ffには最大の256種類の音色が定義してある。
結果/	総ての音色はeffec.ff内から使用され、
	音色データ付きの曲データが作成される。

ex.2
>mc sample3 effec
条件1/	sample3.mml中には一部の音色しか定義されていない。
条件2/	effec.ffには最大の256種類の音色が定義してある。
結果/	定義されていない音色はeffec.ff内から使用され、
	音色データ付きの曲データが作成される。

-------------------------------------------------------------------------------
3)	PMD内部の音色データエリア中の音色。
-------------------------------------------------------------------------------
1.	コマンドラインに/Vオプション又は音色ファイル名を指定してある
2.	使用されている音色がMML中に定義されていない
3.	音色ファイル名が指定されている場合、音色ファイル内にも定義されていない
	(例えば音色データが@128までしか無い音色ファイルを指定して、MML内で
	 @200が使われ、且つその音色はMML中で定義されていない場合)
4.	PMDが常駐されている
	の４つの条件が重なった場合に、自動的に使用されます。
	4.だけ満たしていない場合は、PMD内音色データエリアは全て00Hであると
	仮定されます。
	
	VED.EXEで作成された .FF フォーマットの音色は、VSET.COM でPMD内部に
	転送出来ます。2)の例をこの場合にあてはめると、VSETでPC88.FFをPMD内部に
	あらかじめ転送してあれば、コンパイル時にコマンドラインにPC88.FFと
	指定する必要もなくなります。

ex.1
>mc /v sample4
条件1/	sample4.mml中には音色は定義されていない。
条件2/	PMDが常駐している。
結果/	PMD音色データエリア内の音色を使用し、
	音色データ付きの曲データが作成される。

ex.2
>mc sample5 pc88
条件1/	sample5.mml中には音色は定義されていない。
条件2/	sample5.mml中には@0〜@255までの音色をまんべんなく使用している。
条件3/	pc88.ffには@0〜@126までのデータが定義されている。
条件4/	PMDが常駐している。
結果/	@126まではPC88.FF内から、@127以降はPMD音色データエリア内の音色を
	使用し、音色データ付きの曲データが作成される。

ex.3	(失敗例)
>mc /v sample6
条件1/	sample6.mml中には一部の音色しか定義されていない。
条件2/	PMDが常駐していない。
結果/	MML中に定義されていない残りの音色は発音されない、
	音色データ付きの曲データが作成される。

-------------------------------------------------------------------------------
4)	曲データ中に全く音色を入れない。
-------------------------------------------------------------------------------
	コマンドラインに/Vオプションも音色ファイル名も指定されていない場合は、
	例えMML中に音色が定義されていたとしても、曲データ中には定義されません。

	この場合、演奏時に前述のPMD内部音色バッファの音色を使用して演奏
	されます。

	ある意味特殊で殆ど使いませんが、こうして作成された曲データは、
・	同じ曲データを複数の音色セットで演奏する
・	同じ音色セットで複数の曲データを演奏する
	といった事が可能です。

ex.1
>mc sample7
条件/	sample7.mml中に総ての音色が定義されている。
結果/	定義されている音色は総て無視し、音色データ無しの曲データが作成される。

ex.2
>mc /vw sample8 test
条件1/	sample8.mml中に総ての音色が定義されている。
条件2/	test.ffは存在しない。
結果/	PMD内音色データにsample8.mml内の音色を追加した、test.ffが作成され、
	音色データ無しの曲データが作成される。

===============================================================================
	環境変数 PMD について
-------------------------------------------------------------------------------
	コンパイル時のMMLファイル、音色ファイル、#Includeファイル、
	演奏(/P,/Sオプション)時のPCMファイルは、カレントに見つからないと、
	SET PMD= で指定された環境変数を探して、それをパスとしてサーチします。
	SET PATH= と全く同様の書式で指定します。

	また、現Versionでは、ファイルにパス名を記しておいても、見つからなければ
	指定されたパスを削除の上、SET PMD=で指定されたパスを探しに
	行きますので、注意して下さい。

	環境変数PATHと同様、特にDISKベースでの使用の場合は、良く使うパスを
	先に書いておいた方がサーチが速くなりますので、順番を良く考えて
	設定して下さい。

===============================================================================
	環境変数 USER,COMPOSER,ARRANGER について
-------------------------------------------------------------------------------
	MML中で #Composer , #Arranger 命令の表記がされていなかった場合、

	#Composerの場合、
	環境変数 "COMPOSER=" , "USER=" を検索

	#Arrangerの場合、
	環境変数 "ARRANGER=" , "USER=" を検索

	して、発見した場合はそこに定義されている文字列を使用します。
	重複した場合は、環境変数 COMPOSER,ARRANGER が優先されます。

===============================================================================
--------Exsamples
-------------------------------------------------------------------------------

>mc /v/p sam1
	sam1.mmlをコンパイルして演奏する。
	音色データを曲データ内に添付する。

>mc /o/p sam2
	sam2.mmlをコンパイルして演奏する。その際タイトル文字列は表示しない。
	音色データは曲データに添付せず、音色はPMD内部音色データを使って
	演奏する。

>mc /a/p sam4
	sam4.mmlをコンパイルして演奏する。その際ADPCMデータは定義しない。
	音色データは曲データに添付せず、音色はPMD内部音色データを使って
	演奏する。

>mc /v/vw/p sam3 effec
	sam3.mmlをコンパイルして演奏する。
	effec.ffに、MML中に定義されているFM音色データを更新する。
	音色データを曲データ内に添付する。

===============================================================================
			-----	End of MC.DOC	-----
===============================================================================
